<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>MP3 í•™ìŠµ í”Œë ˆì´ì–´</title>

  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background-color: #000;
      color: #FFD600;
      text-align: center;
      padding: 40px;
    }

    .container {
      max-width: 700px;
      margin: auto;
      border: 2px solid #FFD600;
      padding: 25px;
      border-radius: 15px;
      background-color: #111;
    }

    h1 {
      margin-bottom: 20px;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #FFD600;
      background: #000;
      color: #FFD600;
    }

    button {
      margin-top: 10px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      background-color: #FFD600;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .progress-container {
      width: 100%;
      height: 25px;
      background-color: #333;
      border-radius: 12px;
      margin-top: 20px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #FFD600;
      border-radius: 12px;
      transition: width 0.2s linear;
    }

    canvas {
      width: 100%;
      height: 120px;
      background:#000;
      border:2px solid #FFD600;
      border-radius:12px;
      margin-top: 20px;
    }
  </style>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<body>

<div class="container">
  <h1>MP3 í•™ìŠµ í”Œë ˆì´ì–´</h1>

  <p>https://github.com/Jaydo14/English-audio.git</p>

  <input id="mp3Url" type="text" placeholder="https://username.github.io/repo/audio.mp3">

  <button onclick="loadAudio()">ì¬ìƒí•˜ê¸°</button>

  <audio id="audioPlayer" controls style="width:100%; margin-top:15px;"></audio>

  <!-- ğŸ”Š íŒŒí˜• ë¹„ì£¼ì–¼ë¼ì´ì € -->
  <canvas id="visualizer"></canvas>

  <!-- ğŸ“Š ì§„í–‰ë¥  -->
  <div class="progress-container">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <div style="margin-top:10px;">
    í•™ìŠµë¥ : <span id="percent">0</span> %
  </div>

  <div style="margin-top:10px;">
    Firebase ì €ì¥ ìƒíƒœ: <span id="saveStatus">ì•„ì§ ì €ì¥ ì•ˆë¨</span>
  </div>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”¥ğŸ”¥ğŸ”¥ Firebase ì„¤ì • ì˜ì—­ ğŸ”¥ğŸ”¥ğŸ”¥
   Firebase ì½˜ì†”ì—ì„œ ë³µì‚¬í•œ ì„¤ì •ì„ ì—¬ê¸° ë„£ìœ¼ì„¸ìš” */

const firebaseConfig = {
  apiKey: "AIzaSyB2wi17U3OtAxyWRTBWrD4dwfLa8byN97Q",
  authDomain: "build-a-monster-8299b.firebaseapp.com",
  projectId: "build-a-monster-8299b",
  storageBucket: "build-a-monster-8299b.firebasestorage.app",
  messagingSenderId: "763957471990",
  appId: "1:763957471990:web:908147b5f8dd23607d9ad7",
  measurementId: "G-8GTCHR67PS"
};

// Firebase ì´ˆê¸°í™”
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ğŸ§ ì˜¤ë””ì˜¤ ìš”ì†Œ */
const audio = document.getElementById("audioPlayer");
const progressBar = document.getElementById("progressBar");
const percentText = document.getElementById("percent");
const saveStatus = document.getElementById("saveStatus");

/* ğŸ§ ì˜¤ë””ì˜¤ ë¶ˆëŸ¬ì˜¤ê¸° */
function loadAudio() {
  const url = document.getElementById("mp3Url").value;
  audio.src = url;
  audio.play();
  startVisualizer();
}

/* ğŸ“Š ì§„í–‰ë¥  + Firestore ì €ì¥ */
audio.addEventListener("timeupdate", () => {
  if (!audio.duration) return;

  const percent = (audio.currentTime / audio.duration) * 100;

  progressBar.style.width = percent + "%";
  percentText.innerText = percent.toFixed(1);

  // 5% ë‹¨ìœ„ë¡œ ì €ì¥
  if (Math.round(percent) % 5 === 0) {
    saveProgress(percent.toFixed(1));
  }
});

/* ğŸ“ Firestore ì €ì¥ í•¨ìˆ˜ */
function saveProgress(percent) {
  saveStatus.innerText = "ì €ì¥ ì¤‘...";

  db.collection("learningProgress").add({
    mp3: audio.src,
    percent: percent,
    timestamp: new Date()
  })
  .then(() => {
    saveStatus.innerText = "ì €ì¥ ì™„ë£Œ ğŸ‘";
  })
  .catch(() => {
    saveStatus.innerText = "ì €ì¥ ì‹¤íŒ¨ âŒ";
  });
}

/* ğŸ”Š íŒŒí˜• ë¹„ì£¼ì–¼ë¼ì´ì € */
let audioCtx, analyser, source;

function startVisualizer() {
  const canvas = document.getElementById("visualizer");
  const ctx = canvas.getContext("2d");

  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 256;

  source = audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  function draw() {
    requestAnimationFrame(draw);

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    analyser.getByteFrequencyData(dataArray);

    ctx.fillStyle = "#000";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const barWidth = (canvas.width / bufferLength) * 1.8;
    let x = 0;

    for (let i = 0; i < bufferLength; i++) {
      let barHeight = dataArray[i];

      ctx.fillStyle = "#FFD600";
      ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);

      x += barWidth + 1;
    }
  }

  draw();
}
</script>

</body>
</html>
<link rel="manifest" href="manifest.json">